\def\BR{{\cal B}}
\def\DLL{{\rm DLL}}
\def\PDF{{\cal P}}
\def\NDOF{\hbox{\rm ndf}}
\def\coskj{\cos(K,\jpsi)}
\def\funone{{\cal F}^{\rm bkg}_1}
\def\funtwo{{\cal F}^{\rm bkg}_2}
\def\cosks{\cos\theta_{\Kstar}}
\def\cospsi{\cos\theta_{\jpsi}}
\def\cosphi{\cos\theta_{\phiz}}
\def\phiksphi{\Delta{\phi}_{\Kstar,\phiz}}
\def\phikspsi{\Delta{\phi}_{\Kstar,\jpsi}}
\def\cosx{\cos\theta_{X}}
\def\phixphi{\Delta\phi_{X,\phiz}}
\def\phixpsi{\Delta\phi_{X,\jpsi}}
\def\cosz{\cos\theta_{Z}}
\def\phizphi{{\Delta\phi}_{Z,\phiz}}
\def\phizpsi{{\Delta\phi}_{Z,\jpsi}}
\def\mphik{m_{\phiz\kaon}}
\def\mjpsiphi{m_{\jpsi\phiz}}
\def\mjpsik{m_{\jpsi\kaon}}

\def\Kst{{K^*}}
\def\Zm{Z^-}
\def\Zp{Z^+}
%\def\LambdaStar{{\Lambda^*}}
\def\LambdaStar{{N^*}}
%\def\LambdaStarn{{\Lambda^*_{\!n}}}
\def\LambdaStarn{{N^*_{\!n}}}
\def\H{{\cal H}}
\def\F#1{\{#1\}}
\def\BA#1#2#3{{#1}_{{#2}}^{\,\,\F{\!#3\!}}}
\def\Mat{\mathcal{M}}

%\chapter{Maximum likelihood fit of amplitude models}
%\label{chapter:maxlike}

\section{The amplitude fitting formula}
\label{sec:03_matrixelement}

In this section,
the general outline to construct helicity formula is introduced firstly,
as well as the corresponding notation.
Then,
the matrix element for $\Bp\to\jpsi\phi\Km$, $\jpsi\to\mu^+\mu^-$, $\phi\to\Kp\Km$ are described in sequence. 
Assuming the selected events of $K^+K^-$ are all from $\phi$ decays, 
the mass-dependent term of $m_{\Km\Kp}$ for $\phi$ lineshape is common for all decay chains, 
and omitted to save computation time.
Subsequently,  
the method to combine all decay chains togethor is discussed.
Besides,
a possible reduction of number of helicity couplings to determine from the data by their relation to $LS$ couplings is introducted.
Finally,
the method to subtract background contribution from the log-likelihood sum is shown, 
which is also named as "\emph{cFit}".

%In the helicity formalism, 
%a decay $0 \to 1~2$ can be described by a term:
%\begin{equation}
%H_{\lambda_1,\lambda_2} (-1)^{J_2-\lambda_2}  D_{\lambda_0,\lambda_1-\lambda_2}^{J_0}(\phi_1,\theta_0,0)^*R(m_{12})
%\end{equation}
%The $J_i$ and $\lambda_i$ is the spin and helicity of particle $i$ and
%$H_{\lambda_1,\lambda_2}$ is the helicity coupling for this $0\to 1~2$ decay.
%$D_{\lambda_0,\lambda_1-\lambda_2}^{J_0}$ is the Wigner-D function.
%$\phi_1,\theta_0$ are the polar and azimuthal angles of momentum of particle 1 in particle 0 rest frame 
%with the certain coordinate system defined as particle 0 helicity frame. 
%The helicity coordinate system of a particle is defined with $z$-axis aligned with its momentum in the mother helicity frame. 
%The initial coordinate system is arbitrarily defined, 
%and is usually chosen for convenience. 
%Since $\Bp$ is a pseudoscalar particle, 
%there is no polarization associated, 
%and any initial coordinates is equivalent, 
%we just have to define the helicity frame for the decays of $\Bp$ daughters. 
%If particle 0 decays strongly, 
%its lineshape is described by a complex distribution $R(m_{12})$ as a function of the invariant mass of particle 1 and 2; 
%otherwise $R(m_{12})$ is a delta function which is the case for $\jpsi\to\mumu$.


\subsection{Helicity formalism and notation}
\label{subsec:helicity_formalism}

\begin{figure}[!hbtp]
\centering
\includegraphics[width=0.45\textwidth]{Figures/03_Zcs/05_Likelihood/Cartoon/helicity.png}%
\caption{Coordinate axes for the spin quantization of particle $A$ (bottom part), 
   chosen to be the helicity frame of $A$ ($\hat{z_{0}}||\vec{p}_{A}$ in the rest frame of its mother particle or in the laboratory frame),
   together with the polar ($\theta_{B}^{\{A\}}$) and azimuthal ($\phi_{B}^{\{A\}}$) angles of the momentum of its daughter $B$ in the $B$ rest frame (top part). 
   Notice that the directions of these coordinate axes, 
   denoted as $(x_{0}^{\{A\}}, y_{0}^{\{A\}}$ and $z_{0}^{\{A\}})$, 
   do not change when boosting from the helicity frame of $A$ to its rest frame.
   After the Euler rotation $\mathscr{R}(\alpha=\phi_{B}^{\{A\}},\beta=\theta_{B}^{\{A\}},\gamma=0)$ (see the text), 
   the rotated $z$ axis, 
   $\hat{z}_{2}^{\{A\}}$, 
   is aligned with the $B$ momentum; 
   thus the rotated coordinates become the helicity frame of $B$. 
   If $B$ has a sequential decay, 
   then the same boost-rotation process is repeated to define the helicity frame for its daughters.}
\label{fig:helicity}
\end{figure}


For each two-body decay $A\to B C$, 
a coordinate system is set up in the rest frame of $A$,
with $\hat{z}$ being the direction of quantization for its spin. 
We denote this coordinate system as $(x_{0}^{\{A\}}, y_{0}^{\{A\}}, z_{0}^{\{A\}})$, 
where the superscript “$\{A\}$” means “in the rest frame of $A$”, 
while the subscript “$0$” means the initial coordinates. 
For the first particle in the decay chain, 
the choice of these coordinates is arbitrary. 
However, 
once defined, 
these coordinates must be used consistently between all decay sequences described by the matrix element.
For subsequent decays, 
\eg $B\to D E$, 
the choice of these coordinates is already fixed by the transformation from the $A$ to the $B$ rest frames, 
as discussed below. 
Helicity is defined as the projection of the spin of the particle onto the direction of its momentum. 
When the $z$ axis coincides with the particle momentum, 
we denote its spin projection onto it (\ie the $m_{z}$ quantum number) as $\lambda$. 
To use the helicity formalism, 
the initial coordinate system must be rotated to align the $z$ axis with the direction of the momentum of one of the daughter particles, 
\eg the $B$. 
$A$ generalized rotation operator can be formulated in three-dimensional space,
$\mathscr{R}(\alpha,\beta,\gamma)$,
that uses Euler angles. 
Applying this operator results in a sequence of rotations: 
first by the angle $\alpha$ about the $\hat{z_{0}}$ axis, 
followed by the angle $\beta$ about the rotated $\hat{y_{1}}$ axis and then finally by the angle $\gamma$ about the rotated $\hat{z_{2}}$ axis. 
We use a subscript denoting the axes, 
to specify the rotations which have been already performed on the coordinates. 
The spin eigenstates of particle $A$, 
$|J_{A},m_{A}>$, 
in the $(x_{0}^{\{A\}}, y_{0}^{\{A\}}, z_{0}^{\{A\}})$ coordinate system can be expressed in the basis of its spin eigenstates, 
$|J_{A},m_{A}^{'}>$, 
in the rotated $(x_{3}^{\{A\}}, y_{3}^{\{A\}}, z_{3}^{\{A\}})$ coordinate system with the help of Wigner’s D−matrices,
\begin{equation}
   |J_{A},m_{A}> = \sum_{m_{A}^{'}} { D^{J_{A}}_{m_{A},m^{'}_{A}} (\alpha,\beta,\gamma)^{*} |J_{A},m_{A}^{'}> }
\end{equation}
where
\begin{equation}
   d^{j_{a}}_{m_{a},m^{'}_{a}} (\alpha,\beta,\gamma)^{*} 
   = <j,m| \mathscr{r}(\alpha,\beta,\gamma) | j,m^{'}>^{*} 
   = e^{i m \alpha} d^{j}_{m,m^{'}} e^{i m^{'} \gamma}
\end{equation}
and where the small-d Wigner matrix contains known functions of $\beta$ 
that depend on $J,m,m^{'}$.
To achieve the rotation of the original $z_{0}^{\{A\}}$ axis on to the $B$ momentum ($\vec{p}_{B}^{\{A\}}$),
it is sufficient to rotate by $\alpha=\phi_{B}^{\{A\}}$, $\beta =\theta_{B}^{\{A\}}$,
where $\phi_{B}^{\{A\}}$, $\theta_{B}^{\{A\}}$ are the azimuthal and polar angles of the $B$ momentum vector in the original coordinates
\ie $(x_{0}^{\{A\}}, y_{0}^{\{A\}}, z_{0}^{\{A\}})$.
which is depicted in Figure.~\ref{fig:helicity}.
for the case when the quantization axis for the spin of $A$ is its momentum in some other reference frame. 
Since the third rotation is not necessary, 
$\gamma$ is equal to $0$. 
The angle $\theta_{B}^{\{A\}}$ is usually called “the $A$ helicity angle”, 
thus to simplify the $B$ notation we will denote it as $\theta_{A}$. 
For compact notation, 
$\phi_{B}^{\{A\}}$ is denoted as $\phi_{B}$.
These angles can be detemined as,
\begin{align}
\phi_B & =  {\rm atan2}\left( {\BA{p}{B}{A}}_{\!y},\,{\BA{p}{B}{A}}_{\!x} \right) \notag\\
       & =  {\rm atan2}\left( \BA{\hat{y}}{0}{A} \cdot\BA{\vec{p}}{B}{A} ,\, \BA{\hat{x}}{0}{A}\cdot\BA{\vec{p}}{B}{A} \right) \notag\\
       & =  {\rm atan2}\left( (\BA{\hat{z}}{0}{A} \times\BA{\hat{x}}{0}{A}) \cdot\BA{\vec{p}}{B}{A} ,\, \BA{\hat{x}}{0}{A} \cdot \BA{\vec{p}}{B}{A} \right),
   \label{SUPeq:ph}\\
\cos\theta_A & = \BA{\hat{z}}{0}{A} \cdot \BA{\hat{p}}{B}{A}. \label{SUPeq:theta} 
\end{align}

Angular momentum conservation requires $m_A'=m_B'+m_C'=\lambda_B - \lambda_C$
(since $\BA{\vec{p}}{C}{A}$ points in the opposite direction to $\BA{\hat{z}}{3}{A}$, $m_C'=-\lambda_C$).
Each two-body decay adds a multiplicative term to the matrix element
\begin{equation}
 \H_{\lambda_B,\,\lambda_C}^{A\to B\,C}\,D^{\,J_A}_{m_A,\,\lambda_B-\lambda_C}(\phi_B,\theta_A,0)^*.
\label{SUPeq:ABCterm}
\end{equation}
The helicity couplings $\H_{\lambda_B,\,\lambda_C}^{A\to B\,C}$ are complex constants.
Their products from subsequent decays are to be determined by the fit to the data
(they represent the decay dynamics).
If the decay is strong or electromagnetic, 
it conserves parity which reduces the number of independent helicity couplings via the relation\begin{equation}
\H_{-\lambda_B,-\lambda_C}^{A\to B\,C} = P_A\,P_B\,P_C\,(-1)^{J_B+J_C-J_A}\, \H_{\lambda_B,\,\lambda_C}^{A\to B\,C},
\label{SUPeq:parity}
\end{equation}
where $P$ stands for the intrinsic parity of a particle. 

After multiplying terms given by Eq.~(\ref{SUPeq:ABCterm}) for all decays in the decay sequence, 
they must be summed up coherently over the helicity states of intermediate particles, 
and incoherently over the helicity states of the initial and final-state particles. 
Possible helicity values of $B$ and $C$ particles are constrained by 
$|\lambda_B|\le J_B$, $|\lambda_C|\le J_C$ and $|\lambda_B-\lambda_C|\le J_A$.

When dealing with the subsequent decay of the daughter, $B\to D\, E$,
four-vectors of all particles must be first Lorentz boosted to the rest frame of $B$, 
along the $\BA{\vec{p}}{B}{A}$ \ie\ $\BA{\hat{z}}{3}{A}$ direction 
(this is the $z$ axis in the rest frame of $A$ after the Euler rotations; 
the subscript ``3'' is used for the number of rotations performed on the coordinates, 
and the $\gamma=0$,
these coordinates are the same as after the first two rotations).
This is visualized in Figure.~\ref{fig:helicity},
with $B\to D\, E$ particle labels replaced by $A\to B\, C$ labels.
This transformation does not change vectors that are perpendicular to the boost direction.
The transformed coordinates become the initial coordinate system quantizing the spin of $B$ in its
rest frame,
\begin{align}
\BA{\hat{x}}{0}{B} & =\BA{\hat{x}}{3}{A}, \notag\\
\BA{\hat{y}}{0}{B} & =\BA{\hat{y}}{3}{A}, \notag\\
\BA{\hat{z}}{0}{B} & =\BA{\hat{z}}{3}{A}.
\label{SUPeq:xbfromxa}
\end{align}
The processes of rotation and subsequent boosting can be repeated until the final-state particles are reached.
In practice, 
there are two equivalent ways to determine the $\BA{\hat{z}}{0}{B}$ direction.
Using Eq.~(\ref{SUPeq:xbfromxa}) can set it to the direction of the $B$ momentum in the $A$ rest frame
\begin{equation}
\BA{\hat{z}}{0}{B} =\BA{\hat{z}}{3}{A} = \BA{\hat{p}}{B}{A}.
\label{SUPeq:zboost}
\end{equation}
Alternatively, the fact that $B$ and $C$ are back-to-back in the rest frame of $A$ can also be considered, 
$\BA{\vec{p}}{C}{A}= - \BA{\vec{p}}{B}{A}$.
Since the momentum of $C$ is antiparallel to the boost direction from the $A$ to $B$ rest frames,
the $C$ momentum in the $B$ rest frame will be different, but it will still be antiparallel to this boost direction
\begin{equation}
\BA{\hat{z}}{0}{B} = - \BA{\hat{p}}{C}{B}.
\label{SUPeq:zrecoil}
\end{equation}
To determine $\BA{\hat{x}}{0}{B}$
from Eq.~(\ref{SUPeq:xbfromxa}), 
the $\BA{\hat{x}}{3}{A}$ should be calculated first.
After the first rotation by $\phi_B$ about $\BA{\hat{z}}{0}{A}$,
the $\BA{\hat{x}}{1}{A}$ axis is along the component of
$\BA{\vec{p}}{B}{A}$ which is perpendicular to the $\BA{\hat{z}}{0}{A}$ axis
\begin{align}
\BA{\vec{a}}{B\perp z_0}{A} & \equiv (\BA{\vec{p}}{B}{A})_{\perp \BA{\hat{z}}{0}{A}}
                    = {\BA{\vec{p}}{B}{A}} - (\BA{\vec{p}}{B}{A})_{|| \BA{\hat{z}}{0}{A}}, \notag\\
                   & = {\BA{\vec{p}}{B}{A}} - ({\BA{\vec{p}}{B}{A}}\cdot\BA{\hat{z}}{0}{A})\,\BA{\hat{z}}{0}{A}, \notag\\
%\BA{\hat{x}}{1}{A} & = {\BA{\hat{p}}{B}{A}}~_{\perp \BA{\hat{z}}{0}{A}}
%                     = \frac{{\BA{\vec{p}}{B}{A}}~_{\perp \BA{\hat{z}}{0}{A}}}{
%                             |\,{\BA{\vec{p}}{B}{A}}~_{\perp \BA{\hat{z}}{0}{A}}\,|}
\BA{\hat{x}}{1}{A} & = \BA{\hat{a}}{B\perp z_0}{A} = \frac{\BA{\vec{a}}{B\perp z_0}{A}}{|\,\BA{\vec{a}}{B\perp z_0}{A}\,|}.
\label{SUPeq:xonea}
\end{align}
After the second rotation by $\theta_A$ about $\BA{\hat{y}}{1}{A}$,
$\BA{\hat{z}}{2}{A}\equiv \BA{\hat{z}}{3}{A} = \BA{\hat{p}}{B}{A}$, 
and
$\BA{\hat{x}}{2}{A}= \BA{\hat{x}}{3}{A}$ is antiparallel to the component of the $\BA{\hat{z}}{0}{A}$ vector that is perpendicular to the new $z$ axis \ie\ $\BA{\hat{p}}{B}{A}$. 
Thus
\begin{align}
\BA{\vec{a}}{z_0\perp B}{A} & \equiv
(\BA{\hat{z}}{0}{A})_{\perp \BA{\vec{p}}{B}{A}}
                    = {\BA{\hat{z}}{0}{A}} - ({\BA{\hat{z}}{0}{A}}\cdot\BA{\hat{p}}{B}{A})\,\BA{\hat{p}}{B}{A}, \notag\\
\BA{\hat{x}}{0}{B} &=
\BA{\hat{x}}{3}{A}  = \,-\,\, \BA{\hat{a}}{z_0\perp B}{A} = \,-\,\,\frac{\BA{\vec{a}}{z_0\perp B}{A}}{|\,\BA{\vec{a}}{z_0\perp B}{A}\,|}.
%\frac{{\BA{\hat{z}}{0}{A}}~_{\perp \BA{\vec{p}}{B}{A}}}{
%                               |\,{\BA{\hat{z}}{0}{A}}~_{\perp \BA{\vec{p}}{B}{A}}\,|}.
\label{SUPeq:xaxis}
\end{align}
Then obtain $\BA{\hat{y}}{0}{B}=\BA{\hat{z}}{0}{B}\times\BA{\hat{x}}{0}{B}$.

If $C$ also decays, $C\to F\, G$, then the coordinates for the quantization of $C$ spin
in the $C$ rest frame are defined by
\begin{align}
\BA{\hat{z}}{0}{C} & = - \BA{\hat{z}}{3}{A} = \BA{\hat{p}}{C}{A} = - \BA{\hat{p}}{B}{C}, \\
\BA{\hat{x}}{0}{C} & =  \BA{-\hat{x}}{3}{A} = \BA{\hat{a}}{z_0\perp B}{A} = \BA{-\hat{a}}{z_0\perp C}{A}, \label{SUPeq:xcaxis} \\
   \BA{\hat{y}}{0}{C} & = \BA{\hat{y}}{0}{B} = \BA{\hat{z}}{0}{C}\times\BA{\hat{x}}{0}{C},
\label{SUPeq:xcfromxa}
\end{align}
\ie\ the $z$ axis is reflected compared to the system used for the decay of particle $B$
(it must point in the direction of $C$ momentum in the $A$ rest frame),
but the $y$ axis is kept the same, 
since particle $B$ for the rotation used in Eq.~(\ref{SUPeq:ABCterm}) is chosen.
This is to rotate 180 degree about the $y$ axis.



\subsection{Matrix element for the $K^{*+}\to \phi K^+$ decay chain}
For the $\Bp\to \psi K^*_n$, $K^*_n\to \phi K$, $\phi\to K^+K^-$, $\psi\to\mu^+\mu^-$, 
this chain is described by one mass and 5 helicity angles.

The weak decay $\Bp\to \psi K^*_n$ is described only by helicity coupling $\H_{\lambda_\psi}^{B\to \psi K^*_n}$, 
with $\lambda_\psi=\lambda_{K^*}$, 
because $\Bp$ has no spin. 

The strong decay $K^*_n\to \phi K$ is described by helicity couplings, 
angular and mass terms, as
\begin{equation}
\H^{K^*_n}_{\lambda_\phi} D^{\,\,J_{K^*_n}}_{\lambda_{K^*},\,\lambda_\phi}(\phi_\phi,\theta_\Kst,0)^*R_{K^*_n}(m_{\phi K}),
\end{equation}
where the two helicity angles $\phi_\phi$, $\theta_\Kst$ of  $K^*$ decays are defined by the particle $\phi$. 
Wigner-D function requires $|\lambda_\phi|\le J_{K_n^*}$ and $|\lambda_\psi|\le J_{K_n^*}$. 
Strong decay conserves parity, 
and gives the relation $\H^{K^*_n}_{-\lambda_\phi}=(-1)^{J_{K_n^*}}P_{K_n^*}\H^{K^*_n}_{\lambda_\phi}$, 
where $P_{K_n^*}$ is the parity of the $K^*_n$ resonance.

The $\phi\to K^+K^-$ decay provides one term 
\begin{equation}
D^{\,\,1}_{\lambda_{\phi},\,0}(\phi_{K^+},\theta_\phi,0)^*,
\end{equation}
where $K^+$ is used to define the two helicity angles of $\phi_{K^+}$ and $\theta_\phi$ from $\phi$ decays. 
No independent helicity couplings are needed, as the daughters of $\phi$ are spineless.

The electromagnetic decay $\psi\to\mu^+\mu^-$ is described by a term
\begin{equation}
\label{ME:psitomm}
D^{\,\,1}_{\lambda_{\psi},\,\Delta\lambda_\mu}(
\phi_{\mu},\theta_{\psi},0)^*,
\end{equation}
where $\Delta\lambda_{\mu}\equiv\lambda_{\mu^+}-\lambda_{\mu^-}=\,\pm1$,
and $\phi_{\mu},\theta_{\psi}$ are the azimuthal and polar angles of $\mu^+$ for $\Bp$ 
in the $\psi$ rest frame .
There are no independent helicity couplings in Eq.~(\ref{ME:psitomm}), since they are all equal due to conservation of $C$ and $P$ parities.
Therefore, this coupling can be set to unity as its magnitude and phase can be absorbed into the other helicity couplings which are left free in the fit.

Collecting all terms together, the matrix element is 
\begin{align}
\label{eq:KstAmplitude}
&{\Mat}_{\Delta\lambda_\mu}^{\Kst}(\theta_\Kst,\theta_\psi,\theta_\phi, \phi_{(\psi\Kst)}\equiv\phi_{\phi}+ \phi_\mu,\phi_{K^+},m_{\phi K})= \notag\\
&\sum\limits_{\lambda_\psi} e^{i\lambda_{\psi}\phi_{(\psi\Kst)}}d^{\,\,1}_{\lambda_{\psi},\,\Delta\lambda_\mu}(\theta_{\psi})  \sum\limits_{\lambda_\phi}e^{i\lambda_{\phi}\phi_{\Kp}}d^{\,\,1}_{\lambda_{\phi},\,0}(\theta_\phi) \sum\limits_n \H_{\lambda_\psi}^{B\to \psi K^*_n} \H^{K^*_n}_{\lambda_\phi}d^{\,\,J_{K^*_n}}_{\lambda_{\psi},\,\lambda_\phi}(\theta_\Kst) R_{K^*_n}(m_{\phi K}) 
\end{align}
Here, $\phi_{(\psi\Kst)}\equiv\phi_{\phi}+ \phi_\mu$ is the azimuthal angle between the $K^*$ and $\psi$ decay angles
($\phi_{\phi}$ and $\phi_\mu$ cannot be independently probed). Here $\phi_{(\psi\Kst)}$ is denoted as $\phikspsi$ and $\phi_{K^+}$ is denoted as $\phiksphi$ in the main text, respectively. 
The first two terms, summing over $\lambda_\psi=\pm1,0$ and $\lambda_\phi=\pm1,0$, are independent of the other terms, thus can be coded  separately  and cached. The last term depends on $3\times3$ matrix of $\lambda_\psi$ and $\lambda_\phi$ values. 

The term $R_{K^*_N}(m_{K\phi})$ describes the $K^*_n$ 
resonance that appears in the invariant mass distribution of the $K\phi$ system,
\begin{equation}
R_{K^*_n}(m_{K\phi}) =
B'_{L_{B}^{K^*_n}}(p,p_0,d) \left(\frac{p}{M_{B}}\right)^{L_{B}^{K^*_n}} \, 
{\rm BW}(m_{K\phi} | M_{0}^{K^*_n}, \Gamma_{0}^{K^*_n} ) \, 
B'_{L_{K^*_n}}(q,q_0,d) 
%\left(\frac{q}{m_{p\pi}}\right)^{L_{\LambdaStarn}}.
\left(\frac{q}{M_{0}^{K^*_n}}\right)^{L_{K^*_n}}.
\label{SUPeq:resshape}
\end{equation}
Here, $p$ is the $K^*$ momentum in the $B$ rest frame ($p=|\BA{\vec{p}}{K^*}{B}|$).
Similarly, $q$ is the $K$ momentum in the $K^*$ rest frame ($q=|\BA{\vec{p}}{K}{K^*}|$).
The symbols $p_0$ and $q_0$ denote values of these quantities at the resonance peak ($m_{K\phi}=M_0^{K^*}$). 
The orbital angular momentum between the $K^*$ and $\psi$ particles 
in the $B$ decay is denoted as $L_{B}^{K^*}$.
Similarly, $L_{K^*}$ is the orbital angular momentum between the $K$ and $\phi$ in the $K^*$ decay.
For the orbital angular momentum barrier factors, $p^L\,B'_{L}(p,p_0,d)$, 
the Blatt-Weisskopf functions \supercite{Blatt-Weisskopf-1979} is used,
{
\def\1{p\phantom{_0}}
\def\2{p_0}
\small
\begin{align}
\label{SUPeq:blattw}
B'_{0}(p,p_0,d)=&1 \,,\nonumber \\
B'_{1}(p,p_0,d)=&\sqrt{ \frac{1+(\2\,d)^2}{1+(\1\,d)^2} } \,,\nonumber \\
B'_{2}(p,p_0,d)=&\sqrt{ \frac{9+3(\2\,d)^2+(\2\,d)^4}{9+3(\1\,d)^2+(\1\,d)^4} } \,,\\
B'_{3}(p,p_0,d)=&\sqrt{ \frac{225+45(\2\,d)^2+6(\2\,d)^4+(\2\,d)^6}{225+45(\1\,d)^2+6(\1\,d)^4+(\1\,d)^6} } \,,\nonumber\\
B'_{4}(p,p_0,d)=&\sqrt{ \frac{11025+1575(\2\,d)^2+135(\2\,d)^4+10(\2\,d)^6+(\2\,d)^8}{11025+1575(\1\,d)^2+135(\1\,d)^4+10(\1\,d)^6+(\1\,d)^8} } \,,\nonumber \\
B'_{5}(p,p_0,d)=&\sqrt{ \frac{893025+99225(\2\,d)^2+6300(\2\,d)^4+315(\2\,d)^6+15(\2\,d)^8+(\2\,d)^{10}}{
                            893025+99225(\1  \,d)^2+6300(\1  \,d)^4+315(\1  \,d)^6+15(\1  \,d)^8+(\1  \,d)^{10}} } \,\nonumber,
\end{align}
}
$\!\!\!$ to account for the difficulty in creating the orbital angular momentum $L$, which depends on the momentum of 
the decay products $p$ (in the rest frame of the decaying particle) and on the size of the decaying particle 
given by the constant $d$. 
We set $d=3.0~{\rm GeV}^{-1}$ $\sim$0.6~fm.  
The relativistic Breit-Wigner amplitude is given by
\begin{equation}   
{\rm BW}(m | M_0, \Gamma_0 ) = \frac{1}{M_0^2-m^2 - i M_0 \Gamma(m)} \,,
\label{SUPeq:breitwigner}
\end{equation}
where
\begin{equation}   
\Gamma(m)=\Gamma_0 \left(\frac{q}{q_0}\right)^{2\,L_{K^*}+1} \frac{M_0}{m} B'_{L_{K^*}}(q,q_0,d)^2 \,.
\label{SUPeq:mwidth}
\end{equation}


\begin{figure}[!hbtp]
\centering
\includegraphics[width=0.95\textwidth]{Figures/03_Zcs/05_Likelihood/Cartoon/B2PsiKstar.png}%
\caption{Defination of decay angles in the \Kstar chain.}
\label{fig:cartoon_chain_JpsiKstar}
\end{figure}

The angles used here is calculated here and the sketch of angles is shown in Figure.\ref{fig:cartoon_chain_JpsiKstar}.
The $\BA{z}{0}{\Kstar}$ direction is defined by the boost direction from the \Bp rest frame,
which coincides with the $-\BA{\hat{p}}{\psi}{\Kstar}$ direction in this frame,
details have been discussed in Section.~\ref{subsec:helicity_formalism}.
Some expressions to caculate the angles are listed below. 
The axis of $\Kstar$ rest frame is defined as: 
\begin{align}
\BA{\hat{x}}{0}{\Kstar} & = - \frac{\BA{\hat{p}}{\Bp}{LAB} - \left(\BA{\hat{p}}{\Bp}{LAB} \cdot \BA{\hat{p}}{\Kstar}{\Bp} \right) \BA{\hat{p}}{\Kstar}{\Bp} }  
{\left|\BA{\hat{p}}{\Bp}{LAB} - \left(\BA{\hat{p}}{\Bp}{LAB} \cdot \BA{\hat{p}}{\Kstar}{\Bp} \right) \BA{\hat{p}}{\Kstar}{\Bp}\right|}\\
\BA{y}{0}{\Kstar} &= - \BA{\hat{p}}{\psi}{\Kstar} \times \BA{x}{0}{\Kstar}\\
\BA{z}{0}{\Kstar} & = - \BA{\hat{p}}{\psi}{\Kstar}
\end{align}
with this choice,
the polar angle of $\phi$ in $\Kstar$ rest frame can be calculated:
\begin{equation}
\cos \theta_{\Kstar} = -\BA{\hat{p}}{\psi}{\Kstar} \cdot \BA{\hat{p}}{\phi}{\Kstar}
\end{equation}
and the azimuthal angle of $\phi$ in $\Kstar$($\phi_\phi$) rest frame can be determined from Equation.~\ref{SUPeq:ph}.
\begin{equation}
\phi_{\phi} = \mathrm{atan2}  \left( \BA{\hat{y}}{0}{\Kstar} \cdot \BA{\hat{p}}{\phi}{\Kstar} , \BA{\hat{x}}{0}{\Kstar} \cdot \BA{\hat{p}}{\phi}{\Kstar} \right)
\label{eq:ME_phi_phi}
\end{equation}
For the rest frame of $\psi$, the definition of axis:
\begin{align}
\BA{\hat{x}}{0}{\psi} & = - \BA{\hat{x}}{0}{\Kstar}\\
\BA{y}{0}{\psi} &= \BA{y}{0}{\Kstar}\\
\BA{z}{0}{\psi} & = - \BA{z}{0}{\Kstar}
\end{align}
The polar angle of $\mup$ in $\psi$ rest frame ($\theta_{\psi}$):
\begin{equation}
\cos \theta_{\psi} = -\BA{\hat{p}}{\Kstar}{\psi} \cdot \BA{\hat{p}}{\mup}{\psi}
\end{equation}
and the corresponding azimuthal angle of $\mup$ in $\psi$ rest frame:
\begin{equation}
\phi_{\mu} = \mathrm{atan2}  \left( \BA{\hat{y}}{0}{\psi} \cdot \BA{\hat{p}}{\mup}{\psi} , \BA{\hat{x}}{0}{\psi} \cdot \BA{\hat{p}}{\mup}{\psi} \right)
\end{equation}
%The definition of axis of $\phi$ rest frame is shown:
%\begin{align}
%\BA{\hat{x}}{0}{\phi} & = - \frac{- \BA{\hat{p}}{\psi}{\Kstar} + \left(\BA{\hat{p}}{\psi}{\Kstar} \cdot \BA{\hat{p}}{\phi}{\Kstar} \right) \BA{\hat{p}}{\phi}{\Kstar} }  
%{\left|- \BA{\hat{p}}{\psi}{\Kstar} + \left(\BA{\hat{p}}{\psi}{\Kstar} \cdot \BA{\hat{p}}{\phi}{\Kstar} \right) \BA{\hat{p}}{\phi}{\Kstar}\right|}\\
%\BA{y}{0}{\phi} &= - \BA{\hat{p}}{\KS}{\phi} \times \BA{x}{0}{\phi}\\
%\BA{z}{0}{\phi} & = - \BA{\hat{p}}{\KS}{\phi}
%\end{align}
%The polar angle of $\Kp$ in $\phi$ rest frame is defined as:
The same calculation procedure is applied to $\phi\to\Kp\Km$ channel,
the polaor angle of $\Kp$ in $\phi$ rest frame is defined as:
\begin{equation}
\cos \theta_{\phi} = -\BA{\hat{p}}{\KS}{\Kstar} \cdot \BA{\hat{p}}{\Kp}{\phi}
\end{equation}
and azimuthal angle of $\Kp$ in $\phi$ rest frame:
\begin{equation}
\phi_{K} = \mathrm{atan2}  \left(  \BA{\hat{y}}{0}{\phi} \cdot \BA{\hat{p}}{\Kp}{\phi}, \BA{\hat{x}}{0}{\phi} \cdot \BA{\hat{p}}{\Kp}{\phi} \right)
\end{equation}




\subsection{Matrix element for the $Z^+ \to \psi K^+$ chain}
The chain of $\Bp\to \Z^+_j \phi$, $Z^+_j\to \psi K^+$, $\phi\to K^+K^-$,  $\psi\to \mu^+\mu^-$ also contains four terms. 
The $\Bs\to \Z^+_j \phi$ gives a term, $\H^{B\to Z_j \phi}_{\lambda_{\phi}^Z}$ and limits $\lambda_{Z}=\lambda_{\phi}^Z$. 
The superscript $Z$ in $\lambda_{\phi}$ accounts for different helicity frame than that in the $K^*$ chain. 

The $Z^+_j \to \psi K^+$ is described by one term 
\begin{equation}
\H_{\lambda_\psi^{Z}}^{Z_{j}}D^{\,\,J_{Z_j}}_{\lambda_Z,\,\lambda_\psi^{Z}}(\phi_\psi^Z,\theta_{Z},0)^*R_{Z_j}(m_{\psi K}),
\end{equation}
The helicity angles of $Z$ decays $\phi_\psi^Z$ and $\theta_{Z}$ are defined by the $\psi$ direction. 
The strong decay conserve parity, which gives the relation $\H_{-\lambda_\psi^{Z}}^{Z_{j}}=(-1)^{J_{Z_j}-1}P_{Z_j}\H_{\lambda_\psi^{Z}}^{Z_{j}}$.

The $\phi\to K^+K^-$ provides one term 
\begin{equation}
D^{\,\,1}_{\lambda^Z_{\phi},\,0}(\phi^Z_{K^+},\theta^Z_\phi,0)^*,
\end{equation}
where $K^+$ is used to define the two helicity angles of $\phi^Z_{K^+}$ and $\theta^Z_\phi$ from $\phi$ decays. We use the superscript $Z$ to differentiate from the $\Kst$ chain. 

The $\psi\to\mu^+\mu^-$ decay is described by the term
\begin{equation}
D^{\,\,1}_{\lambda^{Z}_{\psi},\,\Delta\lambda^{Z}_\mu}(
\phi_{\mu}^{Z},\theta_{\psi}^{Z},0)^*.
\end{equation}
Since the muons are final-state particles,
their helicity states in the $Z$ decay chain, $|\lambda_\mu^{Z}\rangle$, 
need to be rotated to the muon helicity states in the $f$ decay chain, $|\lambda_\mu\rangle$, 
before the $Z$ matrix element terms can be coherently added to the $f$ matrix element terms. 
The term aligning the muon helicity states between the two reference frames is given by
\begin{equation}
   \sum\limits_{\lambda_\mu^{Z}} D^{\,\,J_\mu}_{\lambda_\mu^{Z}\,\lambda_\mu}(\alpha^{Z}_\mu,0,0)^* =
 \sum\limits_{\lambda_\mu^{Z}} e^{i\,\lambda_\mu^{Z}\alpha^{Z}_\mu} \delta_{\lambda_\mu^{Z},\,\lambda_\mu}
= e^{i\,\lambda_\mu\alpha^{Z}_\mu}.
\end{equation}
The transformation of $\mu^-$ states will be similar to that of the $\mu^+$ states, except that since $\hat{z}_\psi$ will have the opposite direction, 
$\alpha^{Z}_{{\mu^+}} = - \alpha^{Z}_{\mu^-}$. 
The transformation of $|\lambda_{\mu^+}^{Z}\rangle|\lambda_{\mu^-}^{Z}\rangle$ 
to $|\lambda_{\mu^+}\rangle|\lambda_{\mu^-}\rangle$ states will require multiplying the terms for the $Z$ decay chain by 
\begin{equation}
  e^{i\,\lambda_\mu\alpha^{Z}_\mu} e^{i\,\lambda_{\bar{\mu}}\alpha^{Z}_{\bar{\mu}}} 
=  e^{i\,(\lambda_\mu-\lambda_{\bar{\mu}})\alpha^{Z}_{\mu}} =  e^{i\,\Delta\lambda_\mu\alpha^{Z}_{\mu}}.
\label{SUPeq:mutran}
\end{equation}

The total matrix element for the $Z^+$ chain from $\Bp$ decay is 
\begin{align}
{\Mat}^Z_{\Delta\lambda_\mu}&(\theta_{Z},\theta_\psi^{Z},\theta_\phi^Z,\phi_{(Z\phi)}\equiv\phi^Z_{K^+}+ \phi_\psi^Z,\phi_\mu^{Z},\alpha^{Z}_\mu,m_{\psi\Kp})=e^{i\Delta\lambda_\mu\alpha^{Z}_{\mu}} \sum\limits_{\lambda_\psi^{Z}}e^{i \lambda^{Z}_{\psi} \phi_{\mu}^{Z}}d^{\,\,1}_{\lambda^{Z}_{\psi},\,\Delta\lambda_\mu}(\theta_{\psi}^{Z})  \notag\\
&\times \sum\limits_{\lambda^Z_{\phi}}e^{i\lambda^Z_{\phi} \phi_{(Z\phi)}} d^{\,\,1}_{\lambda^Z_{\phi},\,0}(\theta^Z_\phi) 
\sum\limits_{j}\H^{B\to Z_j \phi}_{\lambda_{\phi}^Z} \H_{\lambda_\psi^{Z}}^{Z_{j}} d^{\,\,J_{Z_j}}_{\lambda_{\phi}^Z,\,\lambda_\psi^{Z}}(\theta_{Z})R_{Z_j}(m_{\psi K}).
\end{align}


\begin{figure}[!hbtp]
\centering
\includegraphics[width=0.95\textwidth]{Figures/03_Zcs/05_Likelihood/Cartoon/B2ZPhi.png}%
   \caption{Defination of decay angles in the $Z^{+}$ chain.}
\label{fig:cartoon_chain_ZPhi}
\end{figure}

The angles used in $Z$ chain are defined in Figure.\ref{fig:cartoon_chain_ZPhi}.
The polar angle of $\phi$ in $Z$ rest frame can be calculated:
\begin{equation}
\cos \theta_{Z} = -\BA{\hat{p}}{\phi}{Z} \cdot \BA{\hat{p}}{\psi}{Z}
\end{equation}
The axis of $Z$ rest frame is defined as: 
\begin{align}
\BA{\hat{x}}{0}{Z} & = - \frac{\BA{\hat{p}}{\Bz}{LAB} - \left(\BA{\hat{p}}{\Bz}{LAB} \cdot \BA{\hat{p}}{Z}{\Bz} \right) \BA{\hat{p}}{Z}{\Bz} }  
{\left|\BA{\hat{p}}{\Bz}{LAB} - \left(\BA{\hat{p}}{\Bz}{LAB} \cdot \BA{\hat{p}}{Z}{\Bz} \right) \BA{\hat{p}}{Z}{\Bz}\right|}\\
\BA{\hat{y}}{0}{Z} &= - \BA{\hat{p}}{\phi}{Z} \times \BA{\hat{x}}{0}{Z}\\
\BA{\hat{z}}{0}{Z} & = - \BA{\hat{p}}{\phi}{Z}
\end{align}
The azimuthal angle of $\psi$ in $Z$ rest frame can be determined from:
\begin{equation}
\phi_{\psi}^{Z} = \mathrm{atan2}  \left( \BA{\hat{y}}{0}{Z} \cdot \BA{\hat{p}}{\psi}{Z} , \BA{\hat{x}}{0}{Z} \cdot \BA{\hat{p}}{\psi}{Z} \right)
\end{equation}
For the rest frame of $\phi$, the definition of axis:
\begin{align}
{\hat{x}}_{0}^{\{\phi\}Z} & = - \BA{\hat{x}}{0}{Z}\\
{\hat{y}}_{0}^{\{\phi\}Z} &= \BA{\hat{y}}{0}{Z}\\
{\hat{z}}_{0}^{\{\phi\}Z} & = - \BA{\hat{z}}{0}{Z}
\end{align}
The polar angle of $\Kp$ in $\phi$ rest frame:
\begin{equation}
\cos \theta_{\phi}^{Z} = -{\hat{p}}_{Z}^{\{\phi\}Z} \cdot {\hat{p}}_{\Kp}^{\{\phi\}Z}
\end{equation}
The azimuthal angle of $\Kp$ in $\phi$ rest frame:
\begin{equation}
\phi_{K}^{Z} = \mathrm{atan2}  \left( {\hat{y}}_{0}^{\{\phi\}Z} \cdot {\hat{p}}_{\Kp}^{\{\phi\}Z} , {\hat{x}}_{0}^{\{\phi\}Z} \cdot {\hat{p}}_{\Kp}^{\{\phi\}Z} \right)
\end{equation}
The definition of axis of $\psi$ rest frame is shown:
\begin{align}
{\hat{x}}_{0}^{\{\psi\}Z} & = - \frac{- \BA{\hat{p}}{\phi}{Z} + \left(\BA{\hat{p}}{\phi}{Z} \cdot \BA{\hat{p}}{\psi}{Z} \right) \BA{\hat{p}}{\psi}{Z} }  
{\left| - \BA{\hat{p}}{\phi}{Z} + \left(\BA{\hat{p}}{\phi}{Z} \cdot \BA{\hat{p}}{\psi}{Z} \right) \BA{\hat{p}}{\psi}{Z} \right|}\\
{\hat{y}}_{0}^{\{\psi\}Z} &= - {\hat{p}}_{\KS}^{\{\psi\}Z} \times {\hat{x}}_{0}^{\{\psi\}\Z}\\
{\hat{z}}_{0}^{\{\psi\}Z} & = - {\hat{p}}_{\KS}^{\{\psi\}Z}
\end{align}
The polar angle of $\mup$ in $\psi$ rest frame is defined as:
\begin{equation}
\cos \theta_{\psi}^{Z} = -{\hat{p}}_{\KS}^{\{\psi\}Z} \cdot {\hat{p}}_{\mup}^{\{\psi\}Z}
\end{equation}
The azimuthal angle of $\mup$ in $\psi$ rest frame:
\begin{equation}
\phi_{\mu}^{Z} = \mathrm{atan2}  \left(  {\hat{y}}_{0}^{\{\psi\}Z} \cdot {\hat{p}}_{\mup}^{\{\psi\}Z}, {\hat{x}}_{0}^{\{\psi\}Z} \cdot {\hat{p}}_{\mup}^{\{\psi\}Z} \right)
\end{equation}
The angle $\alpha_\mu^{Z}$ is defined as:
\begin{equation}
\alpha_\mu^{Z} = \mathrm{atan2}\left( \left(  \hat{z}_0^{\{\mup\}Z}  \times  \hat{x}_0^{\{\mup\}Z}  \right) \cdot \hat{x}_0^{\{\mup\}\Kstarz}, \hat{x}_0^{\{\mup\}Z}  \cdot \hat{x}_0^{\{\mup\}\Kstarz} \right)
\end{equation}
$\hat{z}_0^{\{\mup\}Z}$ means the z axis of $\mup$ rest frame in the $Z$ chain. Other symbols are similar. 
Here, $\hat{x}_0^{\{\mup\}\Kstarz}$, $\hat{x}_0^{\{\mup\}Z}$ and $\hat{x}_0^{\{\mup\}Z}$ are defined as:
\begin{align}
\label{Eq:app_axis_murest_in_kstar_chain}
\hat{x}_0^{\{\mup\}\Kstarz} & = 
- \frac{ -\hat{p}_{\Kstarz}^{\{\psi\}} + \left( \hat{p}_{\Kstarz}^{\{\psi\}} \cdot 
\hat{p}_{\mup}^{\{\psi\}} \right) 
\hat{p}_{\mup}^{\{\psi\}} }
{\left| -\hat{p}_{\Kstarz}^{\{\psi\}} + \left( \hat{p}_{\Kstarz}^{\{\psi\}} \cdot 
\hat{p}_{\mup}^{\{\psi\}} \right) 
\hat{p}_{\mup}^{\{\psi\}}  \right|}  \\%%%%%%%%
\hat{x}_0^{\{\mup\}Z} & = 
- \frac{ -\hat{p}_{\KS}^{\{\psi\}} + \left( \hat{p}_{\KS}^{\{\psi\}} \cdot 
\hat{p}_{\mup}^{\{\psi\}} \right) 
\hat{p}_{\mup}^{\{\psi\}} }
{\left| -\hat{p}_{\KS}^{\{\psi\}} + \left( \hat{p}_{\KS}^{\{\psi\}} \cdot 
\hat{p}_{\mup}^{\{\psi\}} \right) 
\hat{p}_{\mup}^{\{\psi\}}  \right|} \\ %%%%%%% 
\hat{z}_0^{\{\mup\}Z} & = \hat{p}_{\mup}^{\{\psi\}}
\end{align}
Keep in mind that the axes have to be calculated in the same $\psi$ rest frame.



\subsection{Matrix element for the $X \to \psi \phi$ chain}
The decay chain of $\Bp\to X_i \Kp$, $X_i\to \psi \phi$, $\phi\to K^+K^-$,  $\psi\to \mu^+\mu^-$ also contains four terms. 
The $\Bs\to X_i \Kp$ gives a constant term $\H^{\Bp\to X_i \Kp}$ and limits $\lambda_{X}=\lambda_{K}^X=0$. 

The $X_i \to \psi \phi$ is described by the term 
\begin{equation}
\H_{\lambda_\psi^{X},\lambda_\phi^X}^{X_{i}}D^{\,\,J_{X_i}}_{0,\,\lambda_\psi^{X}-\lambda_\phi^X}(\phi_\psi^X,\theta_{X},0)^*R_{X_i}(m_{\psi \phi}),
\end{equation}
The helicity angles of $X$ decays $\phi_\psi^X$ and $\theta_{X}$ are defined by the $\psi$ direction. 
The strong decay conserves parity, which gives the relation $\H_{-\lambda_\psi^{X},-\lambda_\phi^{X}}^{X}=(-1)^{J_{X}}P_{X_j}\H_{\lambda_\psi^{X},\lambda_\phi^{X}}^{X}$.

The $\phi\to K^+K^-$ provides one term 
\begin{equation}
D^{\,\,1}_{\lambda^X_{\phi},\,0}(\phi^X_{K^+},\theta^X_\phi,0)^*,
\end{equation}
where $K^+$ is used to define the two helicity angles of $\phi^X_{K^+}$ and $\theta^X_\phi$ from $\phi$ decays. 
We use the superscript $X$ to differentiate from the other decay chains. 

The $\psi\to\mu^+\mu^-$ decay is described by the term
\begin{equation}
D^{\,\,1}_{\lambda^{X}_{\psi},\,\Delta\lambda^{X}_\mu}(
\phi_{\mu}^{X},\theta_{\psi}^{X},0)^*.
\end{equation}
The muon helicity states are aligned by $\alpha^X_\mu$ rotation.

The total matrix element for the $X$ chain from $\Bp$ decay is 
\begin{align}
{\Mat}^X_{\Delta\lambda_\mu}&(\theta_{X},\theta_\psi^{X},\theta_\phi^X, \phi_{K^+}^X,\phi_\mu^{X},\alpha^{X}_\mu,m_{\psi\phi})=e^{i\Delta\lambda_\mu\alpha^{X}_{\mu}} \sum\limits_{\lambda_\psi^{X}}e^{i \lambda^{X}_{\psi} \phi_{\mu}^{X}}d^{\,\,1}_{\lambda^{X}_{\psi},\,\Delta\lambda_\mu}(\theta_{\psi}^{X})  \notag\\
&\times \sum\limits_{\lambda^X_{\phi}}e^{i\lambda^X_{\phi} \phi^X_{K^+}} d^{\,\,1}_{\lambda^X_{\phi},\,0}(\theta^X_\phi) 
\sum\limits_{i}\H^{\Bp\to X_i \Kp}\H_{\lambda_\psi^{X},\lambda_\phi^X}^{X_{i}} d^{\,\,J_{X_i}}_{0,\,\lambda_\psi^{X}-\lambda_\phi^X}(\theta_{X})R_{X_i}(m_{\psi \phi}).
\end{align}
%Here the relation $\Delta\lambda^{X}_\mu=\Delta\lambda_\mu$ is applied. ????

\begin{figure}[!hbtp]
\centering
\includegraphics[width=0.95\textwidth]{Figures/03_Zcs/05_Likelihood/Cartoon/B2XK.png}%
   \caption{Defination of decay angles in the $X$ chain.}
\label{fig:cartoon_chain_XK}
\end{figure}

The angles used in $X$ chain are defined in Figure.\ref{fig:cartoon_chain_XK}.
The polar angle of $\psi$ in $X$ rest frame can be calculated:
\begin{equation}
\cos \theta_{X} = -\BA{\hat{p}}{\KS}{X} \cdot \BA{\hat{p}}{\psi}{X}
\end{equation}
The axis of $X$ rest frame is defined as: 
\begin{align}
\BA{\hat{x}}{0}{X} & = - \frac{\BA{\hat{p}}{\Bz}{LAB} - \left(\BA{\hat{p}}{\Bz}{LAB} \cdot \BA{\hat{p}}{X}{\Bz} \right) \BA{\hat{p}}{X}{\Bz} }  
{\left|\BA{\hat{p}}{\Bz}{LAB} - \left(\BA{\hat{p}}{\Bz}{LAB} \cdot \BA{\hat{p}}{X}{\Bz} \right) \BA{\hat{p}}{X}{\Bz}\right|}\\
\BA{\hat{y}}{0}{X} &= - \BA{\hat{p}}{\KS}{X} \times \BA{\hat{x}}{0}{X}\\
\BA{\hat{z}}{0}{X} & = - \BA{\hat{p}}{\KS}{X}
\end{align}
The azimuthal angle of $\psi$ in $X$ rest frame can be determined from:
\begin{equation}
\phi_{\psi}^{X} = \mathrm{atan2}  \left( \BA{\hat{y}}{0}{X} \cdot \BA{\hat{p}}{\psi}{X} , \BA{\hat{x}}{0}{X} \cdot \BA{\hat{p}}{\psi}{X} \right)
\end{equation}
The definition of axis of $\psi$ rest frame is shown:
\begin{align}
{\hat{x}}_{0}^{\{\psi\}X} & = - \frac{- \BA{\hat{p}}{\KS}{X} + \left(\BA{\hat{p}}{\KS}{X} \cdot \BA{\hat{p}}{\psi}{X} \right) \BA{\hat{p}}{\psi}{X} }  
{\left| - \BA{\hat{p}}{\KS}{X} + \left(\BA{\hat{p}}{\KS}{X} \cdot \BA{\hat{p}}{\psi}{X} \right) \BA{\hat{p}}{\psi}{X} \right|}\\
{\hat{y}}_{0}^{\{\psi\}X} &= - {\hat{p}}_{\phi}^{\{\psi\}X} \times {\hat{x}}_{0}^{\{\psi\}X}\\
{\hat{z}}_{0}^{\{\psi\}X} & = - {\hat{p}}_{\phi}^{\{\psi\}X}
\end{align}
The polar angle of $\mup$ in $\psi$ rest frame is defined as:
\begin{equation}
\cos \theta_{\psi}^{X} = -{\hat{p}}_{\phi}^{\{\psi\}X} \cdot {\hat{p}}_{\mup}^{\{\psi\}X}
\end{equation}
The azimuthal angle of $\mup$ in $\psi$ rest frame:
\begin{equation}
\phi_{\mu}^{X} = \mathrm{atan2}  \left(  \BA{\hat{y}}{0}{\psi} \cdot \BA{\hat{p}}{\mup}{\psi}, \BA{\hat{x}}{0}{\psi} \cdot \BA{\hat{p}}{\mup}{\psi} \right)
\end{equation}
The angle $\alpha_\mu^X$ is defined as:
\begin{equation}
\alpha_\mu^X = \mathrm{atan2}\left( \left(  \hat{z}_0^{\{\mup\}X}  \times  \hat{x}_0^{\{\mup\}X}  \right) \cdot \hat{x}_0^{\{\mup\}\Kstarz}, \hat{x}_0^{\{\mup\}X}  \cdot \hat{x}_0^{\{\mup\}\Kstarz} \right)
\end{equation}
$\hat{z}_0^{\{\mup\}X}$ means the z axis of $\mup$ rest frame in the $X$ chain. Other symbols are similar. 
Here, $\hat{x}_0^{\{\mup\}\Kstarz}$ is defined in Eq.\ref{Eq:app_axis_murest_in_kstar_chain}, $\hat{x}_0^{\{\mup\}X}$ and $\hat{x}_0^{\{\mup\}X}$ are defined as:
\begin{align}
\hat{x}_0^{\{\mup\}X} & = 
- \frac{ -\hat{p}_{\phi}^{\{\psi\}} + \left( \hat{p}_{\phi}^{\{\psi\}} \cdot 
\hat{p}_{\mup}^{\{\psi\}} \right) 
\hat{p}_{\mup}^{\{\psi\}} }
{\left| -\hat{p}_{\phi}^{\{\psi\}} + \left( \hat{p}_{\phi}^{\{\psi\}} \cdot 
\hat{p}_{\mup}^{\{\psi\}} \right) 
\hat{p}_{\mup}^{\{\psi\}}  \right|} \\ %%%%%%% 
\hat{z}_0^{\{\mup\}X} & = \hat{p}_{\mup}^{\{\psi\}}
\end{align}

For the rest frame of $\phi$, the definition of axis:
\begin{align}
\hat{x}_{0}^{\{\phi\} X} & = - \BA{\hat{x}}{0}{X}\\
\hat{y}_{0}^{\{\phi\} X} &= \BA{\hat{y}}{0}{X}\\
\hat{z}_{0}^{\{\phi\} X} & = - \BA{\hat{z}}{0}{X}
\end{align}
The polar angle of $\Kp$ in $\phi$ rest frame:
\begin{equation}
\cos \theta_{\phi}^{X} = -\hat{p}_{\psi}^{\{\phi\}X} \cdot \hat{p}_{\Kp}^{\{\phi\}X}
\end{equation}
The azimuthal angle of $\Kp$ in $\phi$ rest frame:
\begin{equation}
\phi_{K}^{X} = \mathrm{atan2}  \left( \hat{y}_{0}^{\{\phi\}X} \cdot {\hat{p}}_{\Kp}^{\{\phi\}X} , {\hat{x}}_{0}^{\{\phi\}X} \cdot {\hat{p}}_{\Kp}^{\{\phi\}X} \right)
\end{equation}

Finally, total matrix element squared is given by
\begin{equation} 
\left| \Mat \right|^2  = 
\sum\limits_{\Delta\lambda_{\mu}=\pm1}
\left|
\Mat_{\Delta\lambda_\mu}^{\Kst} 
+ 
\Mat_{\Delta\lambda_\mu}^{Z}  
+ \Mat_{\Delta\lambda_\mu}^{X} 
\right|^2
\label{SUPPeq:total_matrixelement}
\end{equation}  

Assuming approximate $\CP$ symmetry, the helicity couplings for $\Bp$ and $\Bm$ can be made equal, 
but the calculation of the angles requires some care, 
since parity ($P$) conservation does not change polar (i.e. helicity) angles, 
but does change azimuthal angles. 
Thus, not only must $\vec{p}_{\mu^-}$ be used instead of $\vec{p}_{\mu^+}$ for $\Bm$ candidates, 
as well as $K^-$ instead of $K^+$ for the $\phi$ decay,  
but also all azimuthal angles must be reflected before entering the matrix element formula:
all $\phi_{i}\to -\phi_{i}$,  
and 
two $\alpha_\mu\to -\alpha_\mu$
\supercite{Chilikin:2013tch}.


\subsection{Usage of $LS$ couplings}

Since not all helicity couplings are independent because of parity conservation in strong decays, 
it is convenient to related them to the $LS$ couplings ($B_{L,S}$) using Clebsch-Gordan coefficients
\begin{equation}
\H_{\lambda_B,\lambda_C}^{A\to B\,C}=\sum_{L} \sum_{S} 
\sqrt{ \tfrac{2L+1}{2J_A+1} } B_{L,S} 
\left( 
\begin{array}{cc|c}
 J_{B} & J_{C} & S \\
 \lambda_{B} & -\lambda_{C} & \lambda_{B}-\lambda_{C} 
\end{array}
\right)
\times
\left( 
\begin{array}{cc|c}
 L  & S & J_A \\
 0 & \lambda_{B}-\lambda_{C} & \lambda_{B}-\lambda_{C}   
\end{array}
\right). 
\label{SUPeq:LS}
\end{equation}
Here $L$ is the orbital angular momentum in the decay, and 
$S$ is the total spin of the daughters, $\vec{S}=\vec{J}_B+\vec{J}_C$
($|J_B-J_C|\le S \le J_B+J_C$).
The $LS$ couplings are all independent since they automatically satisfy the parity conservation relation in strong decays, 
by restricting $L$ value to be odd or even using the selection $P_A=(-1)^L P_B \cdot P_C$, where $P$ is parity of the particle.   

Table~\ref{tab:KLS} shows the allowed $LS$ for various $J^P$ of $K$ excitations. 
The rule also applies to the $Z\to\psi K$ chain, 
because $\psi$ and $\phi$ are vector particles, 
have the same $J^P=1^-$.
For $\Bp\to \psi K^*_n$ decays, $S=L_{B}^{K^*_n}$ can have up to three values, 
$J_{K^*_n}-1$, $J_{K^*_n}$ and $J_{K^*_n}+1$ (except for when $J_{K^*_n}=0$, 
only one value $L_{B}^{K^*_n}=1$ is possible), corresponding to three (or one) $B^{\Bp\to \psi K^*_n}_{L,S}$ couplings, respectively. 
For $K^*_n\to \phi K$ decay, $S=1$, and $|J_{K^*_n}-1|\le L_{K^*_n} \le J_{K^*_n}+1$. 
Again when $J_{K^*_n}=0$, $L_{K^*_n}=1$. 
Parity conservation limits $L_{K^*_n}$ to be even or odd by $P_{K^*_n}=(-1)^{L_{K^*_n}}$, 
and natural parity ($1^-$, $2^+$, $0^+$ is forbidden) allows one $L_{K^*_n}$, 
while unnatural parity ($1^+$, $2^-$ ...) allows two $L_{K^*_n}$.  
Since only the product of $\Bp$ and $K^*_n$ couplings can be determined, 
lowest $L_{\rm min}$ coupling of $K^*$ decay $B^{K^*_n\to \phi K}_{L_{\rm min},S}$ is defined as $(1,0)$,
which reduces one free coupling. 
To summarize whole $K^*$ decay chain,  
$0^+$ ${K^*_n}$ is forbidden, 
$0^-$ is described by one coupling, $1^-$, $2^+$ ... by three couplings, and $1^+$, $2^-$ ... by four couplings.  
The $0^-$  $\nslj{2}{1}{S}{0}$ is chosen as the reference channel, 
and the only one coupling of $B$ decay is fixed to be $(1,0)$.  
This is a very good choice to make fit stable, 
since the state has large and stable fit fraction about 10\%, 
and only-one coupling is directly proportional to its fit fraction. 


For $\Bp\to X_i \Kp$ decays, 
only one coupling is needed, 
the coupling $B^{\Bp\to X_i \Kp}$ is equal to $(1,0)$, 
again because only the product of $\Bp$ and $X_i$ couplings can be determined.  
For $X_i\to \psi \phi$ decays, $S=0,1,2$ and parity conservation relation $P_{X_i}=(-1)^{L_{X_i}}$  reduces $L_{X_i}$ to about half. 
Table~\ref{tab:XLS} shows the allowed $LS$ for various $J^P$ of $X_i$. 
Each $LS$ combination requires one coupling that are determined by the fit.


\begin{table}[!hbtp]
\caption{Allowed $LS$ for various $J^P$ in the $K^*_n \to \phi K$ decay chain.}\label{tab:KLS}
\centering
\begin{tabular}{c|l|l}
$J^P$& $K^*_n \to \phi K$ & $B\to \jpsi K_n^*$ \\\hline
$0^+$& forbidden&-\\
$0^-$& 11 &11\\
$1^+$& 01, 21 &00, 11, 22\\
$1^-$ & 11 &00, 11, 22\\
$2^+$ & 21 &11, 22, 33\\
$2^-$ & 11, 31 &11, 22, 33\\
\end{tabular}
\end{table}

\begin{table}[!hbtp]
\caption{Allowed $LS$ for various $J^P$ in the $X\to\jpsi \phi$ decay chain.}\label{tab:XLS}
\centering
\begin{tabular}{c|l|l}
$J^P$& $X_i\to \jpsi \phi$& $B\to X_i K$ \\\hline
$0^+$& $00$, $22$&00\\
$0^-$& $11$&00\\
$1^+$& $01$, $21$, $22$&11\\
$1^-$ & $10$, $11$, $12$, $32$&11\\
$2^+$ & $02$, $20$, $21$, $22$, $42$&22\\
$2^-$ & $11$, $12$, $31$, $32$&22\\
\end{tabular}
\end{table}






\subsection{$cFit$ technique}

We use \emph{cFit} technique used in the previous publication~\supercite{LHCb-PAPER-2016-018}, which contains both signal and background PDFs.
The signal PDF, $\PDF_{\rm sig}$,
is proportional to the matrix element squared, which 
is a function of six independent variables: 
$m_{\phi K}$ 
and the independent angular variables in the $\Kstar$ decay chain $\Omega$. 
%
The PDF also depends on the fit parameters, $\Pars$, which include the 
helicity couplings, and masses and widths of resonances. 
%
The two other invariant masses, $m_{\phi K}$ and $m_{\jpsi K}$, and 
the angular variables describing the $X$ and $Z_{cs}^+$ decay chains 
depend on $m_{\phi K}$ and $\Omega$, therefore they do not represent independent dimensions. 
%
The signal PDF is given by:
\begin{equation}
\label{eq:sigpdfsplot}
\frac{d\PDF}{d m_{\phi K}\,d\Omega} \equiv \PDF_{\rm sig}(m_{\phi K},\Omega|\Pars)
=\frac{1}{I(\overrightarrow{w})}\big|\Mat(m_{\phi K},\Omega| \Pars)\big|^2
\Phi(m_{\phi K})
\epsilon(m_{\phi K},\Omega),
\end{equation}
where $\Mat(m_{\phi K},\Omega|\Pars)$ is the total matrix element given by Eq.~(\ref{SUPPeq:total_matrixelement}) and discussed in detail in Appendix~\ref{SUPPsec:matrixelement}. 
$\Phi(m_{\phi K})=p\,q$ is the phase space function, where $p$ is the momentum of
the $\phi K^+$ (\ie $\Kstar$) system in the $B^+$ rest frame, and $q$ is the $K^+$ momentum 
in the $K^{*+}$ rest frame.
The function $\epsilon(m_{\phi K},\Omega)$ is the signal efficiency, and
$I(\Pars)$ is the normalization integral,
\begin{equation}
I(\Pars)\equiv \int \PDF_{\rm sig}(m_{\phi K},\Omega)\,d m_{\phi K}\,d\Omega \propto
\frac{\sum_j w_j^{\rm MC}\big|\Mat(m_{Kp~j},\Omega_j|\Pars)\big|^2}{\sum_j w_j^{\rm MC}},
\label{eq:signor}
\end{equation}
where the sum is over simulated events, which are
generated uniformly in $B^+$ decay phase space 
and passed through the detector simulation \supercite{LHCb-PROC-2011-006}
and data selection.
In the simulation, $pp$ collisions producing $B^+$ mesons are generated using
\pythia~\supercite{Sjostrand:2006za}  with a specific \lhcb
configuration~\supercite{LHCb-PROC-2010-056}. 
The weights $w_j^{\rm MC}$ introduced in Eq.~(\ref{eq:signor}) contain 
corrections to the $B^+$ production kinematics and multiplicity in the generation 
and to the detector response 
to bring the simulations into better agreement with the data.
The simulation sample contains 390\,000 events reconstructed and selected,
approximately 15 times the signal size in data. Run1 MC $w_j^{\rm MC}$ is multiplied by a constant 
scale (about 0.5) to let the sum of weights is proportional to the signal yield found in data, \ie the ratio of MC sum weights is
the same as the ratio of signal yields in Run 1 and Run 2 data.
This procedure folds the detector response into the model 
and allows a direct determination of the parameters of interest from the uncorrected data. 
The resulting log-likelihood 
sums over the data events (here for illustration, $\PDF=\PDF_{\rm sig}$),
{%
\def\1{\ifthenelse{\boolean{prl}}{}{\!\!}}
\begin{equation}
\begin{split}
\ln L(\Pars) & = \sum_i \ln \PDF_{\rm sig}(m_{\phi K~i},\Omega_i|\Pars)  \\%\notag\\
 & = \sum_i \ln \big|\Mat(m_{\phi K~i},\Omega_i|\Pars)\big|^2  - N\ln I(\Pars) + \sum_i \ln[ \Phi(m_{\phi K~i})\epsilon(m_{\phi K~i},\Omega_i) ],
\end{split}
\end{equation}
}%
where the last term does not depend on $\Pars$ and can be dropped ($N$ is the total number of the events in the fit).   

In addition to the signal PDF, $\PDF_{\rm sig}(m_{\phi K},\Omega|\Pars)$,
the background PDF, $\PDF_{\rm bkg}(m_{\phi K},\Omega)$ 
determined from the $B^+$ mass peak sidebands, is included.
%
We minimize the negative log-likelihood defined as
\begin{equation}
\begin{split}
& -\ln L(\Pars)=
-\sum_i\ln \left[ (1-\beta)\, \PDF_{\rm sig}(m_{\phi K~i},\Omega_i|\Pars)
    + \beta\, \PDF_{\rm bkg}(m_{\phi K~i},\Omega_i) \right] \\%\nonumber \\
&=-\sum_i\ln \left[ (1-\beta)\,\frac{\big|\Mat(m_{\phi K~i},\Omega_i|\Pars)\big|^2 \Phi(m_{\phi K~i})\epsilon(m_{\phi K~i},\Omega_i)}{I(\Pars)}
+\beta\, \frac{\PDF_{\rm bkg}^{u}(m_{\phi K~i},\Omega_i)}{I_{\rm bkg}} \right] \\%\nonumber \\
%&=-\sum_i\ln \left\{ \frac{(1-\beta)\,\Phi(m_{\phi K~i})\epsilon(m_{\phi K~i},\Omega_i)}{I(\Pars)}\,\left[\big|\Mat(m_{\phi K~i},\Omega_i|\Pars)\big|^2 
%\right.\right. 
%\nonumber\\
%& \quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad \left.\left.
%+ \frac{\beta\,I(\Pars)}{(1-\beta)\,I_{\rm bkg}}\, \frac{\PDF_{\rm bkg}^{u}(m_{\phi K~i},\Omega_i)}{\Phi(m_{\phi K~i})\epsilon(m_{\phi K~i},\Omega_i)} 
%\right] \right\} \\%\nonumber \\
&=-\sum_i\ln \left[\big|\Mat(m_{\phi K~i},\Omega_i|\Pars)\big|^2  
+ \frac{\beta\,I(\Pars)}{(1-\beta) I_{\rm bkg}}\,\frac{\PDF_{\rm bkg}^{u}(m_{\phi K~i},\Omega_i)}{\Phi(m_{\phi K~i})\epsilon(m_{\phi K~i},\Omega_i)}\right]
+N\ln I(\Pars)+{\rm const.},
\end{split}
\end{equation}
where $\beta$ is the background fraction in the peak region determined from the fit to
the $m_{\jpsi \phi K}$ distribution (Figure.~\ref{fig:MassFit_run}), 
$\PDF_{\rm bkg}^{u}(m_{\phi K},\Omega)$ is the unnormalized background density proportional to the density of sideband events,
with its normalization determined by\footnote{Notice that the distribution of MC events 
includes both the $\Phi(m_{\phi K})$ and $\epsilon(m_{\phi K},\Omega)$ factors, which cancel their product in the numerator.}
\begin{equation}
I_{\rm bkg}\equiv \int \PDF_{\rm bkg}^{u}(m_{\phi K})\,d m_{\phi K}\,d\Omega \, \propto \,
\frac{
\sum_j w_j^{\rm MC} \frac{\PDF_{\rm bkg}^{u}(m_{\phi K~j},\Omega_j)}{\Phi(m_{\phi K~i})\epsilon(m_{\phi K~j},\Omega_j)}}{
\sum_j w_j^{\rm MC}}.
\label{eq:bkgnor}
\end{equation}


The equation above implies that the background term is efficiency corrected,
so it can be added
to the efficiency-independent signal probability expressed by $\left|\Mat\right|^2$.
This way the efficiency parameterization, $\epsilon(m_{\phi K},\Omega)$, 
becomes a part of the background description which affects only a very small part 
of the total PDF.

The efficiency parameterization
in the background term is assumed to factorize as
\begin{equation}
\begin{split}
\lefteqn{\epsilon(m_{\phi K},\Omega)=\epsilon_1(m_{\phi K},\cosks)\,\,\epsilon_2(\cosphi|m_{\phi K})\times} \\%\notag\\
&\quad\quad\quad\quad \epsilon_3(\cospsi|m_{\phi K})\,\, \epsilon_4(\phiksphi|m_{\phi K})\,\,\epsilon_5(\phikspsi|m_{\phi K}).
\end{split}
\label{eq:peff}
\end{equation}
The $\epsilon_1(m_{\phi K},\cosks)$ term is obtained by binning 
a two-dimensional (2D) histogram of the simulated signal events. 
Each event is given a $1/(p\,q)$ weight, 
since at the generator level the phase space is flat in $\cosks$ 
but has a $p\,q$ dependence on $m_{\phi K}$.
A bi-cubic function is used to interpolate between bin centers.
The $\epsilon_1(m_{\phi K},\cosks)$ efficiency and
its visualization across the normal Dalitz plane are shown in Figure.~\ref{fig:effm}.
The other terms are again built from 2D histograms, 
but with each bin divided by the number of simulated events in the corresponding 
$m_{\phi K}$ slice to remove the dependence on this mass (Figure.~\ref{fig:effepsilon2345}).

\begin{figure}[tbhp]
  \begin{center}
    \includegraphics[width=0.8\textwidth]{Figures/03_Zcs/05_Likelihood/effm1m2}
  \end{center}
  \vskip-0.3cm\caption{
     Parameterized efficiency representation in the Dalitz plane $({\mjpsiphi^2}, {\mphik^2})$.
     Function values corresponding to the color encoding are given on the right.
     The normalization arbitrarily corresponds to unity when averaged over the phase space.     
  \label{fig:effm}
  }
\end{figure}

\begin{figure}[bthp]
  \begin{center}
    \includegraphics[width=0.8\textwidth]{Figures/03_Zcs/05_Likelihood/effAngles} 
  \end{center}
  \vskip-0.3cm\caption{\small
     Parameterized efficiency 
     $\epsilon_2(\cosphi|m_{\phi K})$, $\epsilon_3(\cospsi|m_{\phi K})$,  
     $\epsilon_4(\phiksphi|m_{\phi K})$, $\epsilon_5(\phikspsi|m_{\phi K})$
     functions.
     Function values corresponding to the color encoding are given on the right.
     By construction each function integrates to unity at each $m_{\phi K}$ value.  
     The structure in $\epsilon_2(\cosphi|m_{\phi K})$ present 
     between 1500 and $1600 \mev$ is an artifact of 
     removing $\Bp \to \jpsi K^+ K^- K^+$ events in which both $K^+K^-$ combinations 
     pass the $\phi$ mass selection window. 
  }\label{fig:effepsilon2345}
\end{figure}

The background PDF, $\PDF_{\rm bkg}^{u}(m_{\phi K},\Omega)/\Phi(m_{\phi K})$, 
is built using the same approach,
\begin{equation}
\begin{split}
\lefteqn{
\frac{{\PDF_{\rm bkg}^{u}}(m_{\phi K},\Omega)}{\Phi(m_{\phi K})}=
{P_{\rm bkg}}_1(m_{\phi K},\cosks)\,\,{P_{\rm bkg}}_2(\cosphi|m_{\phi K})\times}
\\%\notag\\
&\quad\quad\quad{P_{\rm bkg}}_3(\cospsi|m_{\phi K})\,\, {P_{\rm bkg}}_4(\phiksphi|m_{\phi K})\,\,{P_{\rm bkg}}_5(\phikspsi|m_{\phi K}).
\end{split}
\label{eq:pbkg}
\end{equation}
The background function ${P_{\rm bkg}}_1(m_{\phi K},\cos\theta_\Kstar)$ is 
shown in Figure.~\ref{fig:bkgdaleffs} and the other terms are shown in 
Figure.~\ref{fig:bkgeffs2345}.

\begin{figure}[bthp]
  \begin{center}
    \includegraphics[width=0.8\textwidth]{Figures/03_Zcs/05_Likelihood/bkgm1m2}
  \end{center}
  \vskip-0.3cm\caption{
     Parameterized background representation in the Dalitz plane $({\mjpsiphi^2},{\mphik^2})$.
     Function values corresponding to the color encoding are given on the right.
     The normalization arbitrarily corresponds to unity when averaged over the phase space.
  \label{fig:bkgdaleffs}
  }
\end{figure}


\begin{figure}[tbhp]
  \begin{center}
    \includegraphics[width=0.8\textwidth]{Figures/03_Zcs/05_Likelihood/bkgAngles} 
  \end{center}
  \vskip-0.3cm\caption{
     Parameterized background functions: $P^u_{\rm bkg\,2}(\cosphi|m_{\phiz\kaon})$,
     $P^u_{\rm bkg\,3}(\cospsi|m_{\phiz\kaon})$, $P^u_{\rm bkg\,4}(\phiksphi|m_{\phiz\kaon})$,
     $P^u_{\rm bkg\,5}(\phikspsi|m_{\phiz\kaon})$.
     Function values corresponding to the color encoding are given on the right.
     By construction each function integrates to unity at each $m_{\phi K}$ value.  
  \label{fig:bkgeffs2345}
  }
\end{figure}

The fit fraction (\FiFr) of any component $R$ is defined as,
\begin{equation}
\FiFr = \frac{
\int \left|\Mat^R(m_{\phi K},\Omega)\right|^2 \Phi(m_{\phi K})\,dm_{\phi K}d\Omega
}{
\int \left|\Mat(m_{\phi K},\Omega)\right|^2 \Phi(m_{\phi K})\,dm_{\phi K}d\Omega
},
\label{eq:ff}
\end{equation}
where in $\Mat^R$ 
all terms except those associated with the $R$ amplitude are set to zero. 










